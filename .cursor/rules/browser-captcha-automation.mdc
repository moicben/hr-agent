---
description: Automatisation navigateur avec CAPTCHA (reCAPTCHA, Turnstile)
alwaysApply: true
---

# Automatisation navigateur avec CAPTCHA

## Outil à privilégier

**Utiliser Playwright (user-playwright MCP)** pour toute tâche impliquant un CAPTCHA ou reCAPTCHA. Le navigateur intégré Cursor (cursor-ide-browser) **ne peut pas interagir avec le contenu des iframes** — le reCAPTCHA échoue systématiquement.

## Workflow pour résoudre un CAPTCHA image (grille 3x3 ou 4x4)

1. **Remplir le formulaire** et cliquer sur le bouton de soumission
2. **Capturer une screenshot** du dialogue CAPTCHA via `browser_run_code` :
   ```js
   const recaptchaFrame = page.frames().find(f => f.url().includes("bframe"));
   await recaptchaFrame.locator("[role='dialog']").screenshot({ path: "captcha.png" });
   ```
3. **Analyser l'image** (Read) pour identifier les cellules correspondant à l'instruction
4. **Cliquer par coordonnées** : le CAPTCHA est dans une iframe, utiliser `page.mouse.click(x, y)` avec les coordonnées calculées depuis le `boundingBox()` du dialogue
5. **Gérer les défis successifs** : reCAPTCHA peut afficher "Please also check the new images" — refaire screenshot + analyse + clics
6. **Cliquer sur Verify** une fois les bonnes images sélectionnées

## Coordonnées de la grille 3x3

Pour un dialogue ~400×580 px, la grille commence après l'en-tête (~80px). Chaque cellule ~133×133 px. Centres approximatifs (depuis le coin du dialogue) :
- Ligne 1 : y ~200 ; Ligne 2 : y ~333 ; Ligne 3 : y ~467
- Colonne 1 : x ~67 ; Colonne 2 : x ~200 ; Colonne 3 : x ~333

## Cas spécifique : inscription Serper (serper.dev/signup)

- Formulaire : First, Last, Email, Password
- CAPTCHA reCAPTCHA après "Create account"
- Itérer jusqu'à validation complète (redirection vers /verify-email)
